<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="google-signin-client_id" content="712871956261-l85reugeijrjs9donqeh4j6dboev17up.apps.googleusercontent.com">
  </head>
<body>
  
  <h1>Sign in with Google - Test 11</h1>
  <div id="g_id_onload"
     data-client_id="712871956261-l85reugeijrjs9donqeh4j6dboev17up"
     data-login_uri="https://oholeitorah.github.io/"
     data-auto_select="true"
     data-auto_prompt="false">
  </div>
<!--   <div class="g_id_signin"
     data-type="standard"
     data-size="large"
     data-theme="outline"
     data-text="sign_in_with"
     data-shape="rectangular"
     data-logo_alignment="left">
  </div> -->


<!--   <script src="https://apis.google.com/js/platform.js" async defer></script> -->
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  
  
  
  
      <script>
        function handleCredentialResponse(response) {
          console.log("Encoded JWT ID token: " + response.credential);
          var response = decodeJwtResponse(response.credential);
          var options = {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(response),
//             mode: 'no-cors',
//             Headers: {
//               Accept: 'application.json',
//               'Content-Type': 'application/json'
//             },
//             Body: JSON.stringify(response),
//             Cache: 'default'            
          }
          console.log(response);
          fetch('https://script.google.com/macros/s/AKfycbzusu6YEhHM43g0mlpCggmuRFs4ivQvYLIzXrXtp3Apbh7dCmZgWxTBcgRemdenUhbYxA/exec', options)
          .then(response => {console.log(response); response.json()})
          .then(data => {
            console.log(data);
            //take action based on true or false
          });
          console.log('were here!');
//           window.location.replace("https://www.google.com");
        }
        
        window.onload = function () {
          google.accounts.id.initialize({
            client_id: "712871956261-l85reugeijrjs9donqeh4j6dboev17up",
            callback: handleCredentialResponse
          });
          google.accounts.id.renderButton(
            document.getElementById("buttonDiv"),
            { theme: "outline", size: "large" }  // customization attributes
          );
          google.accounts.id.prompt(); // also display the One Tap dialog
        }
        
        function decodeJwtResponse(token){
          var base64Url = token.split('.')[1];
          var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
          var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
              return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
          }).join(''));

          return JSON.parse(jsonPayload);        
        }
    </script>
    <div id="buttonDiv"></div> 
  
  </body>
</html>

